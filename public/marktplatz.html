<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Final Hell | Marktplatz</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
body{background:radial-gradient(circle at top,#1b1b1b,#050505);color:#e5e5e5;font-family:'Orbitron',sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px;}
.container{background:rgba(20,20,20,0.95);padding:40px;border-radius:16px;width:500px;text-align:center;box-shadow:0 0 25px rgba(255,0,0,0.5);}
h1{color:#c10000;margin:20px 0;}
.logo{width:120px;height:120px;margin-bottom:20px;object-fit:contain;}
label{display:block;text-align:left;margin-top:10px;font-weight:bold;color:#ff4c4c;}
input,textarea,select,button{width:100%;margin:5px 0 15px 0;padding:10px;border-radius:8px;border:none;font-family:'Orbitron',sans-serif;font-size:14px;background:#222;color:white;}
textarea{resize:none;height:100px;}
button{background:#c10000;color:white;cursor:pointer;font-weight:bold;transition:.3s;}
button:hover{background:#ff1a1a;transform:scale(1.03);}
.info-field{display:none;}
#marketMessage,#marketConfirm{font-weight:bold;margin-top:10px;}
#marketConfirm{color:#ffcc00;}
</style>
</head>
<body>
<div class="container">
<img src="logo.png" alt="Logo" class="logo">
<h1>Marktplatz</h1>

<label for="marketCategory">Kategorie</label>
<select id="marketCategory" onchange="updateFields()">
<option value="Ich suche">Ich suche</option>
<option value="Ich biete">Ich biete</option>
<option value="Auftrag">Auftrag</option>
<option value="Hilfe">Hilfe</option>
<option value="Verkauf">Verkauf</option>
<option value="Ankauf">Ankauf</option>
</select>

<label for="marketTitle">Titel</label>
<input type="text" id="marketTitle" placeholder="Titel">

<label for="marketIC">IC Name (optional)</label>
<input type="text" id="marketIC" placeholder="IC Name">

<label for="marketDesc">Beschreibung</label>
<textarea id="marketDesc" placeholder="Beschreibung"></textarea>

<div id="verkaufFields" class="info-field">
<label for="priceField">Preis</label>
<input type="text" id="priceField" placeholder="Preis">
<label for="conditionField">Zustand</label>
<input type="text" id="conditionField" placeholder="Neu / Gebraucht / Defekt">
<label for="amountField">Menge</label>
<input type="number" id="amountField" placeholder="Anzahl">
</div>

<div id="auftragFields" class="info-field">
<label for="auftragField">Auftragsdetails</label>
<textarea id="auftragField" placeholder="Details"></textarea>
</div>

<div id="hilfeFields" class="info-field">
<label for="hilfeField">Hilfebedarf</label>
<textarea id="hilfeField" placeholder="Was wird ben√∂tigt?"></textarea>
</div>

<label for="imageField">Bild (optional, URL)</label>
<input type="text" id="imageField" placeholder="Bild URL">

<button onclick="confirmSend()">Senden</button>

<div id="marketConfirm"></div>
<div id="marketMessage"></div>
</div>

<script>
const categoryColors={
"Ich suche":0x3498db,"Ich biete":0x2ecc71,"Auftrag":0xf1c40f,"Hilfe":0xe67e22,"Verkauf":0xe74c3c,"Ankauf":0x9b59b6
};

function updateFields(){
const c=document.getElementById("marketCategory").value;
document.getElementById("verkaufFields").style.display=c==="Verkauf"?"block":"none";
document.getElementById("auftragFields").style.display=c==="Auftrag"?"block":"none";
document.getElementById("hilfeFields").style.display=c==="Hilfe"?"block":"none";
}

function confirmSend(){
document.getElementById("marketConfirm").innerHTML='‚ö†Ô∏è Sicher senden?<br><button onclick="sendMarket()">Ja</button> <button onclick="cancelSend()">Abbrechen</button>';
}
function cancelSend(){document.getElementById("marketConfirm").innerText="‚ùå Versand abgebrochen";}

async function sendMarket(){
const title=document.getElementById("marketTitle").value.trim()||"Kein Titel";
const desc=document.getElementById("marketDesc").value.trim()||"Keine Beschreibung";
const category=document.getElementById("marketCategory").value;
const ic=document.getElementById("marketIC").value||"Anonym";
const image=document.getElementById("imageField").value||"https://i.imgur.com/default.png";
let extra="";
if(category==="Verkauf") extra=`üí∞ Preis: ${document.getElementById("priceField").value||"N/A"}\nüõ† Zustand: ${document.getElementById("conditionField").value||"N/A"}\nüì¶ Menge: ${document.getElementById("amountField").value||"1"}`;
if(category==="Auftrag") extra=`üìã Auftragsdetails:\n${document.getElementById("auftragField").value||"Keine Details"}`;
if(category==="Hilfe") extra=`üÜò Hilfebedarf:\n${document.getElementById("hilfeField").value||"Keine Details"}`;

const embed={embeds:[{title,description:desc+"\n\n"+extra,color:categoryColors[category],footer:{text:`Kategorie: ${category} | Von: ${ic}`,icon_url:"logo.png"},thumbnail:{url:image}}]};

const msg=document.getElementById("marketMessage");
const confirmDiv=document.getElementById("marketConfirm");

try{
const res=await fetch("/send-market",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(embed)});
if(!res.ok){ const t=await res.text(); console.error(t); msg.style.color="#ff4c4c"; msg.innerText="‚ùå Fehler"; return; }
msg.style.color="#00ff7f"; msg.innerText="‚úÖ Gesendet!";
}catch(err){ console.error(err); msg.style.color="#ff4c4c"; msg.innerText="‚ùå Fehler";}

// Reset
document.getElementById("marketTitle").value=""; document.getElementById("marketDesc").value=""; document.getElementById("marketIC").value="";
document.getElementById("priceField").value=""; document.getElementById("conditionField").value=""; document.getElementById("amountField").value="";
document.getElementById("auftragField").value=""; document.getElementById("hilfeField").value=""; document.getElementById("imageField").value="";
confirmDiv.innerHTML="";
}
</script>
</body>
</html>

